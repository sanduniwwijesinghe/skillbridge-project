<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillBridge | Expert Mentorship</title>
    <script src="https://js.stripe.com/v3/"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6D28D9;
            --primary-hover: #5B21B6;
            --light-gray: #f3f4f6;
            --medium-gray: #d1d5db;
            --dark-gray: #374151;
            --text-color: #111827;
        }
        body { font-family: 'Inter', sans-serif; margin: 0; background-color: var(--light-gray); color: var(--text-color); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        header { background-color: #fff; padding: 1rem 2rem; text-align: center; border-bottom: 1px solid var(--medium-gray); display: flex; justify-content: space-between; align-items: center; }
        header h1 { color: var(--primary-color); margin: 0; font-weight: 700; }
        main { padding: 2rem; max-width: 1200px; margin: auto; }
        .container { background-color: #fff; padding: 2rem; border-radius: 8px; margin-bottom: 2rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -2px rgba(0,0,0,0.1); }
        .hidden { display: none !important; }
        input[type="email"], input[type="password"], input[type="text"], select { width: 100%; padding: 0.75rem; margin: 0.5rem 0; border-radius: 6px; border: 1px solid var(--medium-gray); box-sizing: border-box; font-size: 1rem; }
        button { width: 100%; padding: 0.75rem; background-color: var(--primary-color); color: white; font-weight: 600; cursor: pointer; border: none; border-radius: 6px; font-size: 1rem; transition: background-color 0.2s ease; }
        button:hover { background-color: var(--primary-hover); }
        .auth-toggle { text-align: center; margin-top: 1rem; }
        .auth-toggle a { color: var(--primary-color); text-decoration: none; font-weight: 500; }
        #profile-type-selector { margin: 1rem 0; text-align: center; display: flex; justify-content: center; gap: 1.5rem; }
        .profile-type-option { padding: 0.75rem 1.5rem; border: 1px solid var(--medium-gray); border-radius: 6px; cursor: pointer; transition: all 0.2s ease; }
        .profile-type-option input { display: none; }
        .profile-type-option.selected { border-color: var(--primary-color); background-color: #f5f3ff; color: var(--primary-color); font-weight: 500; }
        .mentor-fields { max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; }
        .mentor-fields.visible { max-height: 500px; }
        .multi-select-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.5rem; }
        .multi-select-container label { display: block; padding: 0.5rem; border: 1px solid var(--medium-gray); border-radius: 4px; cursor: pointer; text-align: center; }
        .multi-select-container input:checked + label { background-color: var(--primary-color); color: #fff; border-color: var(--primary-color); }
        .multi-select-container input { display: none; }
        #welcome-banner { display: flex; justify-content: space-between; align-items: center; }
        #logoutBtn { width: auto; padding: 0.5rem 1rem; font-size: 0.875rem; }
        .filter-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
        .mentor-card { border: 1px solid var(--medium-gray); border-radius: 8px; padding: 1.5rem; transition: box-shadow 0.2s ease; }
        .mentor-card:hover { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -4px rgba(0,0,0,0.1); }
        .mentor-card h3 { margin-top: 0; color: var(--primary-color); }
        .mentor-badge { display: inline-block; background-color: var(--light-gray); color: var(--dark-gray); padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; margin-right: 0.5rem; margin-bottom: 0.5rem; }
        #mentors-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
    </style>
</head>
<body>
    <header>
        <h1>SkillBridge</h1>
        <div id="welcome-banner" class="hidden">
            <span id="currentUserEmail" style="margin-right: 1rem;"></span>
            <button id="logoutBtn">Logout</button>
        </div>
    </header>

    <main>
        <!-- Authentication View -->
        <div id="auth-view" style="max-width: 400px; margin: auto;">
            <div id="login-form" class="container">
                <h3>Sign In to Your Account</h3>
                <input type="email" id="loginEmail" placeholder="Email">
                <input type="password" id="loginPassword" placeholder="Password">
                <button id="loginBtn">Sign In</button>
                <p class="auth-toggle">Don't have an account? <a href="#" onclick="toggleAuth('signup')">Sign Up</a></p>
            </div>
            <div id="signup-form" class="container hidden">
                <h3>Create a New Account</h3>
                <div id="profile-type-selector">
                    <label class="profile-type-option selected"><input type="radio" name="profileType" value="mentee" checked onchange="toggleMentorFields()">I am a Mentee</label>
                    <label class="profile-type-option"><input type="radio" name="profileType" value="mentor" onchange="toggleMentorFields()">I am a Mentor</label>
                </div>
                <input type="email" id="signupEmail" placeholder="Email">
                <input type="password" id="signupPassword" placeholder="Password">
                <!-- Dynamic Mentor Fields -->
                <div id="mentor-fields-container" class="mentor-fields">
                    <h4>Mentor Details</h4>
                    <label for="seniority">Seniority Level</label>
                    <select id="seniority">
                        <option value="senior">Senior Engineer</option>
                        <option value="staff">Staff Engineer</option>
                        <option value="principal">Principal Engineer</option>
                    </select>
                    <label>Domains of Expertise</label>
                    <div class="multi-select-container" id="domains">
                        <input type="checkbox" id="backend" value="backend"><label for="backend">Backend</label>
                        <input type="checkbox" id="frontend" value="frontend"><label for="frontend">Frontend</label>
                        <input type="checkbox" id="devops" value="devops"><label for="devops">DevOps</label>
                        <input type="checkbox" id="data" value="data"><label for="data">Data</label>
                    </div>
                    <label style="margin-top: 1rem;">Specialist Badges</label>
                    <div class="multi-select-container" id="badges">
                        <input type="checkbox" id="interview" value="interview"><label for="interview">Interview Coach</label>
                        <input type="checkbox" id="system-design" value="system-design"><label for="system-design">System Design</label>
                    </div>
                </div>
                <button id="signupBtn">Create Account</button>
                <p class="auth-toggle">Already have an account? <a href="#" onclick="toggleAuth('login')">Sign In</a></p>
            </div>
            <div id="confirm-form" class="container hidden">
                <h3>Confirm Your Email</h3>
                <input type="email" id="confirmEmail" placeholder="Email" disabled>
                <input type="text" id="confirmCode" placeholder="Confirmation Code">
                <button id="confirmBtn">Confirm Account</button>
            </div>
        </div>

        <!-- Mentee Application View -->
        <div id="mentee-view" class="hidden">
            <div class="container filter-section">
                <div>
                    <label for="filter-domain">Filter by Domain</label>
                    <select id="filter-domain" onchange="filterMentors()">
                        <option value="">All Domains</option>
                        <option value="backend">Backend</option>
                        <option value="frontend">Frontend</option>
                        <option value="devops">DevOps</option>
                        <option value="data">Data</option>
                    </select>
                </div>
                <div>
                    <label for="filter-seniority">Filter by Seniority</label>
                    <select id="filter-seniority" onchange="filterMentors()">
                        <option value="">All Levels</option>
                        <option value="senior">Senior</option>
                        <option value="staff">Staff</option>
                        <option value="principal">Principal</option>
                    </select>
                </div>
                <div>
                    <label for="filter-badge">Filter by Badge</label>
                    <select id="filter-badge" onchange="filterMentors()">
                        <option value="">All Badges</option>
                        <option value="interview">Interview Coach</option>
                        <option value="system-design">System Design</option>
                    </select>
                </div>
            </div>
            <div id="mentors-grid">
                <!-- Mentor cards will be dynamically inserted here -->
            </div>
        </div>

        <!-- Mentor Application View -->
        <div id="mentor-view" class="container hidden">
            <h2>Your Mentor Dashboard</h2>
            <p>Welcome! Mentees will be able to find and book sessions with you based on your profile.</p>
            <!-- Mentor-specific features would go here -->
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/aws-amplify@5/dist/aws-amplify.min.js"></script>
    <script>
        // --- CONFIGURATION ---
        const awsConfig = { Auth: { region: 'us-east-1', userPoolId: 'YOUR_USER_POOL_ID', userPoolWebClientId: 'YOUR_USER_POOL_CLIENT_ID' } };
        const httpApiBaseUrl = 'YOUR_HTTP_API_GATEWAY_ENDPOINT';
        Amplify.configure(awsConfig);

        let currentUser = null;
        let allMentors = [];

        // --- AUTH & UI LOGIC ---
        async function checkUser() {
            try {
                currentUser = await Amplify.Auth.currentAuthenticatedUser();
                document.getElementById('currentUserEmail').textContent = `Welcome, ${currentUser.attributes.email}`;
                document.getElementById('welcome-banner').classList.remove('hidden');
                document.getElementById('auth-view').classList.add('hidden');
                
                const profileType = currentUser.attributes['custom:profile_type'];
                if (profileType === 'mentor') {
                    document.getElementById('mentor-view').classList.remove('hidden');
                } else {
                    document.getElementById('mentee-view').classList.remove('hidden');
                    fetchAndDisplayMentors();
                }
            } catch (error) {
                document.getElementById('welcome-banner').classList.add('hidden');
                document.getElementById('auth-view').classList.remove('hidden');
                document.getElementById('mentor-view').classList.add('hidden');
                document.getElementById('mentee-view').classList.add('hidden');
            }
        }

        document.getElementById('signupBtn').addEventListener('click', async () => {
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const profileType = document.querySelector('input[name="profileType"]:checked').value;
            
            const attributes = { 'custom:profile_type': profileType };

            if (profileType === 'mentor') {
                attributes['custom:seniority'] = document.getElementById('seniority').value;
                attributes['custom:domains'] = Array.from(document.querySelectorAll('#domains input:checked')).map(el => el.value).join(',');
                attributes['custom:badges'] = Array.from(document.querySelectorAll('#badges input:checked')).map(el => el.value).join(',');
            }

            try {
                await Amplify.Auth.signUp({ username: email, password, attributes });
                alert('Sign up successful! Please check your email for a confirmation code.');
                document.getElementById('confirmEmail').value = email;
                toggleAuth('confirm');
            } catch (error) { alert(`Error signing up: ${error.message}`); }
        });

        // (rest of the auth event listeners: login, confirm, logout are the same)

        document.getElementById('loginBtn').addEventListener('click', async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            try {
                await Amplify.Auth.signIn(email, password);
                checkUser();
            } catch (error) { alert(`Error logging in: ${error.message}`); }
        });

        document.getElementById('confirmBtn').addEventListener('click', async () => {
            const email = document.getElementById('confirmEmail').value;
            const code = document.getElementById('confirmCode').value;
            try {
                await Amplify.Auth.confirmSignUp(email, code);
                alert('Confirmation successful! You can now log in.');
                toggleAuth('login');
            } catch (error) { alert(`Error confirming sign up: ${error.message}`); }
        });
        
        document.getElementById('logoutBtn').addEventListener('click', async () => {
            try {
                await Amplify.Auth.signOut();
                currentUser = null;
                checkUser();
            } catch (error) { alert(`Error logging out: ${error.message}`); }
        });


        function toggleAuth(form) {
            document.getElementById('login-form').classList.toggle('hidden', form !== 'login');
            document.getElementById('signup-form').classList.toggle('hidden', form !== 'signup');
            document.getElementById('confirm-form').classList.toggle('hidden', form !== 'confirm');
        }

        function toggleMentorFields() {
            const isMentor = document.querySelector('input[name="profileType"][value="mentor"]').checked;
            const container = document.getElementById('mentor-fields-container');
            container.classList.toggle('visible', isMentor);
            
            // Also manage radio button styles
            document.querySelectorAll('.profile-type-option').forEach(el => el.classList.remove('selected'));
            document.querySelector('input[name="profileType"]:checked').parentElement.classList.add('selected');
        }

        // --- MENTOR BROWSING & FILTERING ---
        async function fetchAndDisplayMentors() {
            try {
                const token = currentUser.signInUserSession.idToken.jwtToken;
                const response = await fetch(`${httpApiBaseUrl}/users`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch users');
                const users = await response.json();
                allMentors = users.filter(user => user.profileType === 'mentor');
                renderMentors(allMentors);
            } catch (error) {
                console.error("Error fetching mentors:", error);
                document.getElementById('mentors-grid').innerHTML = '<p>Could not load mentors.</p>';
            }
        }

        function filterMentors() {
            const domainFilter = document.getElementById('filter-domain').value;
            const seniorityFilter = document.getElementById('filter-seniority').value;
            const badgeFilter = document.getElementById('filter-badge').value;

            let filtered = allMentors.filter(mentor => {
                const domainMatch = !domainFilter || (mentor.domains && mentor.domains.includes(domainFilter));
                const seniorityMatch = !seniorityFilter || mentor.seniority === seniorityFilter;
                const badgeMatch = !badgeFilter || (mentor.badges && mentor.badges.includes(badgeFilter));
                return domainMatch && seniorityMatch && badgeMatch;
            });
            renderMentors(filtered);
        }

        function renderMentors(mentors) {
            const grid = document.getElementById('mentors-grid');
            if (mentors.length === 0) {
                grid.innerHTML = '<p>No mentors match the current filters.</p>';
                return;
            }
            grid.innerHTML = mentors.map(mentor => `
                <div class="mentor-card">
                    <h3>${mentor.email}</h3>
                    <p><strong>Seniority:</strong> ${mentor.seniority || 'N/A'}</p>
                    <div>
                        <strong>Domains:</strong>
                        ${(mentor.domains || '').split(',').map(d => d ? `<span class="mentor-badge">${d}</span>` : '').join('')}
                    </div>
                    <div>
                        <strong>Badges:</strong>
                        ${(mentor.badges || '').split(',').map(b => b ? `<span class="mentor-badge">${b}</span>` : '').join('')}
                    </div>
                    <button style="margin-top: 1rem;" onclick="alert('Booking feature coming soon!')">Book Session</button>
                </div>
            `).join('');
        }

        // --- INITIALIZATION ---
        window.addEventListener('load', () => {
            document.querySelectorAll('.profile-type-option').forEach(el => {
                el.addEventListener('click', () => {
                    document.querySelector('input[name="profileType"][value="' + el.querySelector('input').value + '"]').click();
                });
            });
            checkUser();
        });
    </script>
</body>
</html>

